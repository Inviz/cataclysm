<body id="clickable">
<script>P = {version: {commit: Math.random()}}</script>
<link rel="stylesheet" href="engine/styles/page.css" />
<div id="container"></div>

<div id="fixed">
  <div id="dummy"></div>


<header style="display: none;">
  <form id="searchForm">
    <input type="search" placeholder="Searchâ€¦" id="searchInput" />
    <input type="submit" />
  </form>
</header>
</div>

<script src="petri/loader.js"></script>
<script>
  var seed = 2;
  if (location.search.indexOf('random') > -1)
    seed = Math.random()
  var seed = location.search.match(/seed=([^&]+)/);
  if (seed)
    seed = parseFloat(seed[1])


  function Gen() {
    console.time('gen test')
    var state = new Game.Generator(seed)
    var states = [];
    state = state.advance.apply(state, arguments)
    console.timeEnd('gen test')

    return state
  }
  function READY() {
    Game.compile()
    Game.World = Gen()

    P.areas = [];
    Game.World.eachBlock(function(block) {
      var area = new P.Area({
        id: block,
        polygon: this.computeBlockPolygon(block),
        zones: []
      })
      this.eachBuilding(function(building) {
        if (this.getBuildingBlock(building) == block) {
          area.zones.push(new P.Zone({
            area: area,
            id: building,
            polygon: this.computeBuildingShape(building)
          }))
        }
      })
      area.computeAreaBox()
      P.areas.push(area)
    })

    P.city = new P.City({
      areas: P.areas,
      roadNetwork: Game.World.Road.network
    })

    P.initialized = true;
    P.Scene.navigate('map')
    P.animate.start()
  }

</script>
<script src="engine/loader.js"></script>
</body>